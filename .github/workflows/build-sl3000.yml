name: ğŸš€ ç»ˆæ ImmortalWRT ç¼–è¯‘ (Ultimate ImmortalWRT Build)

on:
  workflow_dispatch:
    inputs:
      owner:
        description: "openWRT ä»“åº“çš„æ‹¥æœ‰è€… (Owner of openWRT repo)"
        type: string
        required: true
        default: "immortalwrt"
      repo:
        description: "openWRT ä»“åº“çš„åå­— (Name of openWRT repo)"
        type: string
        required: true
        default: "immortalwrt"
      branch:
        description: "openWRT ä»“åº“çš„åˆ†æ”¯ (Branch of openWRT repo)"
        type: string
        required: true
        default: "openwrt-24.10"
      multithreading:
        description: "å¼€å¯å¤šçº¿ç¨‹ç¼–è¯‘ (Enable multithreading build)"
        type: boolean
        default: true
      ssh:
        description: "ä½¿ç”¨ ssh è¿æ¥åˆ°ç¼–è¯‘ç¯å¢ƒ (Connect to the build environment using ssh)"
        type: boolean
        default: false
      isFiles:
        description: "ä½¿ç”¨fileså¤§æ³• (Whether to upload the etc files)"
        type: boolean
        default: false
      build_strategy:
        description: "ç¼–è¯‘ç­–ç•¥ (Build strategy)"
        type: choice
        options:
          - standard
          - minimal
          - aggressive
        default: "standard"

env:
  BUILD_STRATEGY: ${{ inputs.build_strategy }}
  TIMEOUT_MINUTES: 360
  MAX_RETRIES: 3

jobs:
  pre-build-check:
    runs-on: ubuntu-latest
    outputs:
      disk_available: ${{ steps.check-disk.outputs.available_gb }}
      should_proceed: ${{ steps.check-disk.outputs.should_proceed }}
    steps:
      - name: ğŸ•µï¸ ç³»ç»Ÿèµ„æºæ£€æŸ¥ (System Resource Check)
        id: check-disk
        run: |
          echo "æ£€æŸ¥ç³»ç»Ÿèµ„æº..."
          AVAILABLE_GB=$(df -BG / | awk 'NR==2 {print $4}' | sed 's/G//')
          echo "å¯ç”¨ç£ç›˜ç©ºé—´: ${AVAILABLE_GB}GB"
          
          # æ ¹æ®ç­–ç•¥å†³å®šæœ€å°ç©ºé—´è¦æ±‚
          case "$BUILD_STRATEGY" in
            "minimal")
              MIN_SPACE=25
              ;;
            "aggressive")
              MIN_SPACE=15
              ;;
            *)
              MIN_SPACE=30
              ;;
          esac
          
          echo "æœ€å°è¦æ±‚ç©ºé—´: ${MIN_SPACE}GB"
          echo "available_gb=${AVAILABLE_GB}" >> $GITHUB_OUTPUT
          
          if [ "${AVAILABLE_GB}" -lt "${MIN_SPACE}" ]; then
            echo "âŒ ç£ç›˜ç©ºé—´ä¸è¶³ï¼Œéœ€è¦ ${MIN_SPACE}GBï¼Œå½“å‰ ${AVAILABLE_GB}GB"
            echo "should_proceed=false" >> $GITHUB_OUTPUT
          else
            echo "âœ… ç£ç›˜ç©ºé—´å……è¶³"
            echo "should_proceed=true" >> $GITHUB_OUTPUT
          fi

  build:
    runs-on: ubuntu-latest
    needs: pre-build-check
    if: needs.pre-build-check.outputs.should_proceed == 'true'
    
    strategy:
      matrix:
        attempt: [1, 2, 3]
      max-parallel: 1
    
    name: ğŸš€ ç¼–è¯‘å°è¯• ${{ matrix.attempt }}/3
    
    steps:
      - name: ğŸ“Š ç¼–è¯‘å¼€å§‹ä¿¡æ¯ (Build Start Info)
        run: |
          echo "=========================================="
          echo "ğŸš€ å¼€å§‹ ImmortalWRT ç¼–è¯‘"
          echo "ç­–ç•¥: $BUILD_STRATEGY"
          echo "å°è¯•: ${{ matrix.attempt }}/$MAX_RETRIES"
          echo "è¶…æ—¶: ${TIMEOUT_MINUTES}åˆ†é’Ÿ"
          echo "=========================================="

      - name: ğŸ—‘ï¸ é˜¶æ®µ1: åŸºç¡€æ¸…ç† (Stage 1: Basic Cleanup)
        run: |
          echo "å¼€å§‹ç¬¬ä¸€é˜¶æ®µæ¸…ç†..."
          sudo sync
          # æ¸…ç†ç³»ç»Ÿç¼“å­˜
          sudo sysctl -w vm.drop_caches=3
          # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
          sudo find /tmp -type f -atime +0 -delete 2>/dev/null || true
          sudo find /var/tmp -type f -atime +0 -delete 2>/dev/null || true
          # æ¸…ç†æ—¥å¿—
          sudo journalctl --vacuum-time=1h
          sudo find /var/log -type f -name "*.log" -exec truncate -s 0 {} \;
          echo "ç¬¬ä¸€é˜¶æ®µæ¸…ç†å®Œæˆ"

      - name: ğŸ—‘ï¸ é˜¶æ®µ2: åŒ…ç®¡ç†å™¨æ¸…ç† (Stage 2: Package Manager Cleanup)
        run: |
          echo "å¼€å§‹åŒ…ç®¡ç†å™¨æ¸…ç†..."
          sudo apt autoclean
          sudo apt autoremove -y --purge
          sudo rm -rf /var/lib/apt/lists/*
          sudo rm -rf /var/cache/apt/archives/*
          # æ¸…ç†å…¶ä»–åŒ…ç®¡ç†å™¨
          for cmd in pip npm yarn; do
            if command -v $cmd >/dev/null; then
              case $cmd in
                pip) python3 -m pip cache purge 2>/dev/null || true ;;
                npm) npm cache clean --force 2>/dev/null || true ;;
                yarn) yarn cache clean 2>/dev/null || true ;;
              esac
            fi
          done
          echo "åŒ…ç®¡ç†å™¨æ¸…ç†å®Œæˆ"

      - name: ğŸ—‘ï¸ é˜¶æ®µ3: æ·±åº¦æ¸…ç† (Stage 3: Deep Cleanup)
        run: |
          echo "å¼€å§‹æ·±åº¦æ¸…ç†..."
          # æ¸…ç†æ–‡æ¡£
          sudo find /usr/share/doc -depth -type f ! -name copyright -delete 2>/dev/null || true
          sudo find /usr/share/doc -empty -delete 2>/dev/null || true
          # æ¸…ç†mané¡µé¢
          sudo rm -rf /usr/share/man/* /usr/share/groff/* /usr/share/info/*
          # æ¸…ç†è¯­è¨€åŒ…ï¼ˆåªä¿ç•™enå’Œzhï¼‰
          sudo find /usr/share/locale -mindepth 1 -maxdepth 1 ! -name 'en*' ! -name 'zh*' -exec rm -rf {} + 2>/dev/null || true
          # ç§»é™¤å¤§å‹è½¯ä»¶åŒ…
          sudo apt remove -y --purge azure-cli google-cloud-sdk firefox microsoft-edge-stable 2>/dev/null || true
          echo "æ·±åº¦æ¸…ç†å®Œæˆ"

      - name: âš¡ è¶…çº§ç£ç›˜ä¼˜åŒ– (Super Disk Optimization)
        uses: easimon/maximize-build-space@master
        with:
          root-reserve-mb: 1024
          swap-size-mb: 0
          remove-dotnet: "true"
          remove-android: "true"
          remove-haskell: "true"
          remove-codeql: "true"
          remove-docker-images: "true"
          remove-android-sdk: "true"
          remove-vcpkg: "true"

      - name: ğŸ—‘ï¸ é˜¶æ®µ4: å®¹å™¨å’Œç¼“å­˜æ¸…ç† (Stage 4: Container and Cache Cleanup)
        run: |
          echo "æ¸…ç†å®¹å™¨å’Œç¼“å­˜..."
          # Docker æ¸…ç†
          if command -v docker >/dev/null; then
            sudo docker system prune -a -f 2>/dev/null || true
          fi
          # Podman æ¸…ç†
          if command -v podman >/dev/null; then
            sudo podman system prune -a -f 2>/dev/null || true
          fi
          # æ¸…ç†ccache
          if command -v ccache >/dev/null; then
            ccache -C
            ccache -z
          fi
          echo "å®¹å™¨å’Œç¼“å­˜æ¸…ç†å®Œæˆ"

      - name: ğŸ“ˆ èµ„æºçŠ¶æ€æŠ¥å‘Š (Resource Status Report)
        run: |
          echo "=========================================="
          echo "ğŸ“Š ä¼˜åŒ–åèµ„æºçŠ¶æ€"
          echo "=========================================="
          df -hT
          echo "------------------------------------------"
          free -h
          echo "------------------------------------------"
          echo "CPUä¿¡æ¯:"
          nproc
          echo "------------------------------------------"
          AVAILABLE_GB=$(df -BG / | awk 'NR==2 {print $4}' | sed 's/G//')
          echo "âœ… å¯ç”¨ç£ç›˜ç©ºé—´: ${AVAILABLE_GB}GB"

      - name: ğŸ“¦ å®‰è£…ç¼–è¯‘ä¾èµ– (Install Build Dependencies)
        run: |
          echo "å®‰è£…ç¼–è¯‘ä¾èµ–..."
          sudo apt update
          # åŸºç¡€ç¼–è¯‘å·¥å…·
          sudo apt install -y build-essential ccache clang cmake gcc-multilib g++-multilib \
                            git libncurses-dev libssl-dev libelf-dev python3 python3-pip \
                            rsync subversion swig unzip wget
          
          # æ ¹æ®ç­–ç•¥å®‰è£…é¢å¤–ä¾èµ–
          case "$BUILD_STRATEGY" in
            "minimal")
              echo "æœ€å°åŒ–ç­–ç•¥ï¼šåªå®‰è£…æ ¸å¿ƒä¾èµ–"
              ;;
            "aggressive")
              sudo apt install -y ack antlr3 asciidoc autoconf automake autopoint \
                                binutils bison bzip2 cpio curl device-tree-compiler \
                                ecj fastjar flex gawk gettext gnutls-dev gperf haveged \
                                help2man intltool lib32gcc-s1 libc6-dev-i386 libglib2.0-dev \
                                libgmp3-dev libltdl-dev libmpc-dev libmpfr-dev libpython3-dev \
                                libreadline-dev libtool libyaml-dev libz-dev lld llvm lrzsz \
                                mkisofs msmtp nano ninja-build p7zip p7zip-full patch pkgconf \
                                python3-ply python3-docutils python3-pyelftools qemu-utils \
                                re2c scons squashfs-tools texinfo uglifyjs upx-ucl vim xmlto xxd \
                                zlib1g-dev zstd
              ;;
            *)
              sudo apt install -y ack antlr3 asciidoc autoconf automake autopoint binutils \
                                bison bzip2 cpio curl device-tree-compiler ecj fastjar flex \
                                gawk gettext gnutls-dev gperf haveged help2man intltool \
                                lib32gcc-s1 libc6-dev-i386 libglib2.0-dev libgmp3-dev \
                                libltdl-dev libmpc-dev libmpfr-dev libpython3-dev libreadline-dev \
                                libtool libyaml-dev libz-dev lld llvm lrzsz mkisofs msmtp nano \
                                ninja-build p7zip p7zip-full patch pkgconf python3-ply \
                                python3-docutils python3-pyelftools qemu-utils re2c scons \
                                squashfs-tools texinfo uglifyjs upx-ucl vim xmlto xxd zlib1g-dev zstd
              ;;
          esac

      - name: ğŸ“¥ å…‹éš†ä»“åº“ (Clone Repositories)
        run: |
          echo "å…‹éš†ä»“åº“..."
          # å…‹éš†å½“å‰é…ç½®ä»“åº“
          git clone https://github.com/${{ github.repository }}.git config-repo
          
          # å…‹éš† ImmortalWRT
          git clone --depth=1 --branch=${{ inputs.branch }} \
            https://github.com/${{ inputs.owner }}/${{ inputs.repo }}.git openWRT
          
          # å¤åˆ¶é…ç½®æ–‡ä»¶
          cp -f config-repo/.config config-repo/diy.sh openWRT/
          
          # å¦‚æœå¯ç”¨filesï¼Œå¤åˆ¶filesç›®å½•
          if [ "${{ inputs.isFiles }}" = "true" ]; then
            cp -rf config-repo/files openWRT/ 2>/dev/null || true
          fi

      - name: âš™ï¸ è¿è¡Œè‡ªå®šä¹‰è„šæœ¬ (Run Custom Scripts)
        working-directory: openWRT
        run: |
          echo "è¿è¡Œè‡ªå®šä¹‰é…ç½®..."
          if [ -f "diy.sh" ]; then
            chmod +x diy.sh
            ./diy.sh
          else
            echo "æœªæ‰¾åˆ° diy.shï¼Œè·³è¿‡è‡ªå®šä¹‰è„šæœ¬"
          fi

      - name: ğŸ”„ æ™ºèƒ½é…ç½®ä¼˜åŒ– (Smart Configuration Optimization)
        working-directory: openWRT
        run: |
          echo "åº”ç”¨æ™ºèƒ½é…ç½®ä¼˜åŒ–..."
          
          # æ ¹æ®ç­–ç•¥ä¼˜åŒ–é…ç½®
          case "$BUILD_STRATEGY" in
            "minimal")
              echo "åº”ç”¨æœ€å°åŒ–ä¼˜åŒ–..."
              # ç¦ç”¨è°ƒè¯•ä¿¡æ¯
              sed -i 's/CONFIG_DEBUG=y/CONFIG_DEBUG=n/' .config
              sed -i 's/CONFIG_DEBUG_INFO=y/CONFIG_DEBUG_INFO=n/' .config
              # å‡å°‘å¹¶è¡Œç¼–è¯‘æ•°
              echo "CONFIG_MAKE_JOBS=2" >> .config
              ;;
            "aggressive")
              echo "åº”ç”¨æ¿€è¿›ä¼˜åŒ–..."
              # ç¦ç”¨æ‰€æœ‰è°ƒè¯•
              sed -i 's/CONFIG_DEBUG=y/CONFIG_DEBUG=n/' .config
              sed -i 's/CONFIG_DEBUG_INFO=y/CONFIG_DEBUG_INFO=n/' .config
              sed -i 's/CONFIG_STRIP=y/CONFIG_STRIP=y/' .config
              # å¯ç”¨å‹ç¼©
              echo "CONFIG_TARGET_OPTIMIZATION=-Os -pipe" >> .config
              ;;
            *)
              echo "åº”ç”¨æ ‡å‡†ä¼˜åŒ–..."
              # æ ‡å‡†ä¼˜åŒ–
              sed -i 's/CONFIG_DEBUG_INFO=y/CONFIG_DEBUG_INFO=n/' .config
              ;;
          esac
          
          # ç¡®ä¿å…³é”®é…ç½®
          echo "CONFIG_SDK=y" >> .config
          echo "CONFIG_CCACHE=y" >> .config

      - name: ğŸ“¥ æ›´æ–° Feeds (Update Feeds)
        working-directory: openWRT
        run: |
          echo "æ›´æ–° feeds..."
          for i in {1..3}; do
            if ./scripts/feeds update -a; then
              echo "Feeds æ›´æ–°æˆåŠŸ"
              break
            else
              echo "Feeds æ›´æ–°å¤±è´¥ï¼Œé‡è¯• $i/3"
              sleep 10
            fi
          done
          
          echo "å®‰è£… feeds..."
          ./scripts/feeds install -a

      - name: ğŸ” é…ç½®éªŒè¯ (Configuration Validation)
        working-directory: openWRT
        run: |
          echo "éªŒè¯é…ç½®..."
          if ! make defconfig; then
            echo "âŒ é…ç½®éªŒè¯å¤±è´¥"
            exit 1
          fi
          echo "âœ… é…ç½®éªŒè¯æˆåŠŸ"

      - name: ğŸš¨ SSH è°ƒè¯•ä¼šè¯ (SSH Debug Session)
        if: ${{ inputs.ssh == true }}
        uses: mxschmitt/action-tmate@v3
        with:
          limit-access-to-actor: true

      - name: ğŸ’¾ ç¼–è¯‘å‰å¤‡ä»½é…ç½® (Backup Config Before Build)
        uses: actions/upload-artifact@v4
        with:
          name: config-backup-attempt-${{ matrix.attempt }}
          path: |
            openWRT/.config
            openWRT/feeds.conf.default
          retention-days: 1

      - name: â° ç¼–è¯‘è¶…æ—¶ä¿æŠ¤ (Build Timeout Protection)
        timeout-minutes: ${{ env.TIMEOUT_MINUTES }}

      - name: ğŸ› ï¸ æ™ºèƒ½ç¼–è¯‘æ‰§è¡Œ (Smart Build Execution)
        working-directory: openWRT
        run: |
          set -e
          echo "å¼€å§‹æ™ºèƒ½ç¼–è¯‘..."
          
          # ç¼–è¯‘å‡½æ•°ï¼Œæ”¯æŒé‡è¯•
          compile_with_retry() {
            local target=$1
            local max_retries=2
            local retry_count=0
            
            while [ $retry_count -lt $max_retries ]; do
              echo "ç¼–è¯‘ $target (å°è¯• $((retry_count+1))/$max_retries)"
              if make $target -j$(( $(nproc) - 1 )) V=s; then
                echo "âœ… $target ç¼–è¯‘æˆåŠŸ"
                return 0
              else
                retry_count=$((retry_count+1))
                if [ $retry_count -lt $max_retries ]; then
                  echo "âŒ $target ç¼–è¯‘å¤±è´¥ï¼Œé‡è¯•..."
                  sleep 30
                else
                  echo "âŒ $target ç¼–è¯‘æœ€ç»ˆå¤±è´¥"
                  return 1
                fi
              fi
            done
          }
          
          # åˆ†é˜¶æ®µç¼–è¯‘
          echo "é˜¶æ®µ 1: å·¥å…·é“¾..."
          compile_with_retry "toolchain/install"
          
          echo "é˜¶æ®µ 2: ç›®æ ‡ç¼–è¯‘..."
          compile_with_retry "target/compile"
          
          echo "é˜¶æ®µ 3: è½¯ä»¶åŒ…ç¼–è¯‘..."
          if [ "$BUILD_STRATEGY" = "aggressive" ]; then
            # æ¿€è¿›ç­–ç•¥ï¼šæŒ‰ç±»åˆ«ç¼–è¯‘
            for category in base network luci kernel; do
              echo "ç¼–è¯‘ $category ç±»åˆ«..."
              compile_with_retry "package/$category/compile"
            done
          else
            compile_with_retry "package/compile"
          fi
          
          echo "é˜¶æ®µ 4: ç”Ÿæˆé•œåƒ..."
          compile_with_retry "package/index"
          
          echo "ğŸ‰ æ‰€æœ‰ç¼–è¯‘é˜¶æ®µå®Œæˆï¼"

      - name: ğŸ“¦ ç¼–è¯‘åä¼˜åŒ– (Post-Build Optimization)
        if: always()
        working-directory: openWRT
        run: |
          echo "ç¼–è¯‘åæ¸…ç†..."
          # æ¸…ç†ä¸­é—´æ–‡ä»¶é‡Šæ”¾ç©ºé—´
          if [ -d "build_dir" ]; then
            find build_dir -name "*.o" -delete 2>/dev/null || true
          fi
          
          # æ£€æŸ¥ç¼–è¯‘ç»“æœ
          if [ -d "bin/targets" ]; then
            echo "âœ… ç¼–è¯‘äº§ç‰©ç”ŸæˆæˆåŠŸ"
            find bin/targets -name "*.bin" -o -name "*.img" | head -10
          else
            echo "âŒ æœªæ‰¾åˆ°ç¼–è¯‘äº§ç‰©"
          fi

      - name: ğŸ’¾ ä¸Šä¼ ç¼–è¯‘ç»“æœ (Upload Build Results)
        if: success()
        uses: actions/upload-artifact@v4
        with:
          name: immortalwrt-build-attempt-${{ matrix.attempt }}
          path: |
            openWRT/bin/targets/
            openWRT/.config
          retention-days: 30
          compression-level: 0

      - name: ğŸ“‹ ç¼–è¯‘æŠ¥å‘Š (Build Report)
        if: always()
        run: |
          echo "=========================================="
          echo "ğŸ“‹ ç¼–è¯‘æŠ¥å‘Š - å°è¯• ${{ matrix.attempt }}"
          echo "=========================================="
          echo "çŠ¶æ€: ${{ job.status }}"
          echo "ç­–ç•¥: $BUILD_STRATEGY"
          echo "æ—¶é—´: $(date)"
          
          if [ -d "openWRT/bin/targets" ]; then
            echo "âœ… ç¼–è¯‘äº§ç‰©:"
            find openWRT/bin/targets -name "*.bin" -o -name "*.img" | head -5
            echo "æ€»å¤§å°: $(du -sh openWRT/bin/targets 2>/dev/null || echo 'æœªçŸ¥')"
          else
            echo "âŒ æ— ç¼–è¯‘äº§ç‰©"
          fi
          
          echo "å‰©ä½™ç£ç›˜ç©ºé—´:"
          df -h / | awk 'NR==2 {print "å¯ç”¨: " $4 ", ä½¿ç”¨ç‡: " $5}'

  success:
    runs-on: ubuntu-latest
    needs: build
    if: always() && contains(needs.build.*.result, 'success')
    
    name: âœ… ç¼–è¯‘æˆåŠŸ (Build Success)
    
    steps:
      - name: ğŸ‰ æˆåŠŸé€šçŸ¥ (Success Notification)
        run: |
          echo "=========================================="
          echo "ğŸ‰ ImmortalWRT ç¼–è¯‘æˆåŠŸï¼"
          echo "=========================================="
          echo "æˆåŠŸå°è¯•: è‡³å°‘æœ‰ä¸€æ¬¡ç¼–è¯‘å°è¯•æˆåŠŸ"

      - name: ğŸ“¥ ä¸‹è½½æœ€æ–°äº§ç‰© (Download Latest Artifacts)
        uses: actions/download-artifact@v4
        with:
          pattern: immortalwrt-build-attempt-*
          path: final-artifacts

      - name: ğŸ“¦ æ‰“åŒ…æœ€ç»ˆç‰ˆæœ¬ (Package Final Release)
        run: |
          echo "åˆ›å»ºæœ€ç»ˆå‘å¸ƒåŒ…..."
          cd final-artifacts
          LATEST_ATTEMPT=$(ls -d immortalwrt-build-attempt-* | sort -V | tail -1)
          cp -r "$LATEST_ATTEMPT" ../immortalwrt-final
          echo "æœ€ç»ˆç‰ˆæœ¬: $LATEST_ATTEMPT"

      - name: ğŸš€ ä¸Šä¼ æœ€ç»ˆç‰ˆæœ¬ (Upload Final Version)
        uses: actions/upload-artifact@v4
        with:
          name: immortalwrt-final-release
          path: immortalwrt-final
          retention-days: 90

  failure:
    runs-on: ubuntu-latest
    needs: [pre-build-check, build]
    if: always() && (needs.pre-build-check.result == 'failure' || !contains(needs.build.*.result, 'success'))
    
    name: âŒ ç¼–è¯‘å¤±è´¥ (Build Failure)
    
    steps:
      - name: ğŸ“‹ å¤±è´¥åˆ†æ (Failure Analysis)
        run: |
          echo "=========================================="
          echo "âŒ ImmortalWRT ç¼–è¯‘å¤±è´¥åˆ†æ"
          echo "=========================================="
          
          if [ "${{ needs.pre-build-check.result }}" = "failure" ]; then
            echo "å¤±è´¥åŸå› : èµ„æºæ£€æŸ¥æœªé€šè¿‡"
            echo "å¯ç”¨ç©ºé—´: ${{ needs.pre-build-check.outputs.disk_available }}GB"
          else
            echo "å¤±è´¥åŸå› : æ‰€æœ‰ç¼–è¯‘å°è¯•å‡å¤±è´¥"
            echo "è¯·æ£€æŸ¥ç¼–è¯‘æ—¥å¿—"
          fi
          
          echo "å»ºè®®:"
          echo "1. æ£€æŸ¥ .config é…ç½®"
          echo "2. å°è¯• 'minimal' ç¼–è¯‘ç­–ç•¥"
          echo "3. ç¡®è®¤è®¾å¤‡æ”¯æŒ"
          echo "4. æŸ¥çœ‹è¯¦ç»†ç¼–è¯‘æ—¥å¿—"

      - name: ğŸ“ ä¸Šä¼ å¤±è´¥æ—¥å¿— (Upload Failure Logs)
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: build-failure-logs
          path: |
            openWRT/build_dir/*/log*
            openWRT/logs/
          retention-days: 7
